# Словари (dict) — теория

## 1. Что такое словарь

`dict` — ассоциативный контейнер: отображение **ключ → значение**.

- доступ по ключу, а не по индексу
- амортизированная сложность операций — O(1)
- порядок элементов сохраняется (Python ≥ 3.7)

```python
d = {"a": 1, "b": 2}
```

---

## 2. Ключи словаря

Ключ должен быть:

- **хешируемым**
- **неизменяемым**

Допустимо:

- `int`, `str`, `tuple` (если внутри тоже хешируемые)

Недопустимо:

- `list`, `dict`, `set`

Причина: словарь — хеш-таблица, хеш ключа должен быть стабильным.

---

## 3. Чтение значений

### Строгое чтение

```python
d[key]
```

- если ключа нет → `KeyError`

Используется, когда отсутствие ключа — **ошибка логики**.

### Мягкое чтение

```python
d.get(key, default)
```

- если ключа нет → `default`
- словарь **не меняется**

Важно: `get` **не сообщает**, был ли ключ, если `default` совпадает со значением.

---

## 4. Проверка наличия ключа

```python
key in d
```

- проверяет **только ключи**
- не зависит от значения
- работает за O(1)

`in` и `get` — **разная семантика**:

- `in` → структура
- `get` → значение

---

## 5. Truthy / falsy ловушка

```python
if d.get("a"):
    ...
```

Ошибка логики, если значение может быть:

- `0`
- `""`
- `False`
- `None`

Наличие ключа и истинность значения — **не одно и то же**.

---

## 6. View-объекты: keys / values / items

```python
d.keys()
d.values()
d.items()
```

Это **view**, а не копии:

- не хранят данные
- отражают текущее состояние словаря
- изменяются при изменении словаря

```python
vals = d.values()
d["c"] = 3
list(vals)  # значения обновятся
```

Во время итерации **нельзя менять словарь** — будет `RuntimeError`.

---

## 7. Перебор словаря

Канонический способ:

```python
for k, v in d.items():
    ...
```

Используется почти всегда.

---

## 8. setdefault

```python
d.setdefault(key, default)
```

Семантика:

- если ключ есть → вернуть значение
- если нет → **создать ключ** со значением `default`

Опасность:

- совмещает чтение и запись
- неочевидная мутация словаря

Использовать **осознанно**, под конкретный паттерн.

---

## 9. defaultdict

```python
from collections import defaultdict

d = defaultdict(list)
```

- `defaultdict` — подкласс `dict`
- при обращении к отсутствующему ключу:
  - вызывается фабрика (например, `list()`)
  - значение создаётся
  - ключ добавляется

Важно:

- фабрика вызывается **только при `d[key]`**
- `get()` фабрику не вызывает

Использовать для:

- накопления
- группировки
- подсчётов

---

## 10. Итоговая ментальная модель

- `dict` — строгий контейнер
- `get` — мягкое чтение
- `in` — проверка структуры
- view — динамическое представление
- `defaultdict` — честный инструмент накопления
