# День 4. Строки в Python: индексация, срезы, неизменяемость

## 1. Строка как объект

В Python 3 строка (`str`) — это полноценный объект, представляющий собой **последовательность Unicode-кодовых точек**.

Ключевые свойства:

- тип: `str`
- объект в куче
- передаётся по ссылке
- реализует протокол последовательности
- **неизменяемая (immutable)**

`str` не является массивом байтов и не хранит информацию о кодировке. Кодировка появляется только при переходе между `str` и `bytes`.

## 2. Unicode-модель

- `str` — последовательность Unicode-кодовых точек
- `len(s)` считает кодовые точки, а не байты и не визуальные символы
- один визуальный символ может состоять из нескольких кодовых точек

Python оперирует кодовыми точками; это сознательное решение модели языка.

## 3. Индексация строк

Индексация — доступ к одному элементу последовательности.

```python
s = "python"
s[0]   # 'p'
s[-1]  # 'n'
```

Свойства:

- индекс — целое число
- допустимый диапазон: `-len(s) ≤ i < len(s)`
- результат — **новый объект `str` длины 1**
- при выходе за границы — `IndexError`

Изменение по индексу запрещено:

```python
s[0] = "P"  # TypeError
```

## 4. Срезы строк

Срез — получение подпоследовательности.

```python
s[start:stop:step]
```

Свойства:

- `start` — включительно
- `stop` — не включительно
- `step` по умолчанию равен 1
- результат — **всегда новая строка**
- срез **никогда не бросает `IndexError`**

Примеры:

```python
s = "abcdef"
s[1:4]     # 'bcd'
s[:3]      # 'abc'
s[3:]      # 'def'
s[::-1]    # 'fedcba'
```

При отрицательном `step` движение идёт справа налево. Если диапазон некорректен — результат пустая строка.

## 5. Неизменяемость строк (immutability)

После создания объект `str` не может быть изменён.

Любая операция «изменения»:

- создаёт **новый объект**
- возвращает ссылку на него
- не затрагивает исходный объект

```python
s = "abc"
s += "d"   # эквивалентно: s = s + "d"
```

Создание нового объекта происходит при вычислении выражения `s + "d"`, после чего имя `s` перепривязывается к результату.

## 6. Инженерные последствия immutability

### Хешируемость

Строки могут быть ключами словарей и элементами множеств.

### Безопасность

Невозможно незаметно изменить строку через другую ссылку.

### Оптимизации

Python может шарить одинаковые строковые объекты (интернирование).

### Производительность

Плохой паттерн:

```python
s = ""
for x in data:
    s += x
```

Причина: каждая конкатенация создаёт новый объект → O(n²).

Правильный паттерн:

```python
s = "".join(data)
```

---

Итог:

- `str` — immutable по контракту языка
- индексация — чтение одного элемента
- срез — получение новой строки
- любые «изменения» — создание нового объекта
